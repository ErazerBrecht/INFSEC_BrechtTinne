#28/12/2015

Vandaag was ons doel om een MiTM (Man In The Middle) aanval uit te voeren.

We bevinden ons al in het netwerk, want we hebben het WiFi wachtwoord gehackt. We zouden graag weten wat eeen host (victim) allemaal doet op het internet, en we zouden graag de wachtwoorden willen stelen!

####Hoe doen we dit?

We zullen aan ARP spoofing doen, hierbij zullen wij ARP pakketjes sturen naar ons slachteroffer met de mededeling wij zijn de gateway naar het internet aka de router. Er is geen beveiling op ARP pakketjes (authenicatie), de computer zal ons dus geloven. En zal telkens hij iets wilt sturen naar het internet (uploaden, POST), dit sturen naar onze computer (Hacker). Natuurlijk zou het opvallen mochten wij uitendelijk de pakketjes niet doorsturen naar de echte gateway, er zou dan immers geen internetverbinding zijn. We lossen dit op door ARP pakketjes te sturen naar de "echte" gateway met als boodschap dat wij (hacker) de hostcomputer zijn (victim). Dit heeft als gevolg elke keer de router een pakketje heeft voor de host (downloaden, GET), hij het zal sturen naar de onze computer (hacker).

TODO FOTO

We kunnen nu perfect al het verkeer afluisteren, en hebben sucessvol een MiTM gedaan!

###Man In The Middle attack without Ettercap

[SOURCE](https://www.youtube.com/watch?v=Vvln4_HfIVg)

IPTables
* TODO

Installeren van arpspoof (dsniff)
* Tool voor het sturen van onze valse ARP pakketjes
* apt-get install dsniff

Installing sslstrip
* Zorgt ervoor dat https request omgezet worden in gewone http request (onversleuteld), zo kunnen we nog steeds kijken wat de vicitim verstuurd!
* [LINK] (http://blog.petrilopia.net/linux/raspberry-pi-install-sslstrip/)

No module twisted web found
* apt-get install python-twisted-web

De originele default gateway vinden
* route -n

Mac address van de default gaateway (192.168.137.1) is dezelfde als onze Raspberry Pi2 (hacker). 

![FOTO](http://i.imgur.com/x5ZWnHw.png)

####Probleem HSTS
TODO

###With Ettercap

Blabla

####Probleem HTTPS + HSTS
Etthercap zal niet zoals bij SSLStrip, https proberen "uiteschakelen". Niet zo'n heel groot probleem. De gebruiker zal een waarschuwing krijgen (rode melding) dat het certificaat niet geldig is en etc. Dit zal op elke https site gebeuren. De gewone gebruiker zal na een tijd geÃ¯riteerd geraken en gewoon op "toch doorgaan" klikken. Groot probleem! Ook nu hebben we nog steeds last van het HSTS verhaal...

We zouden dit kunnen oplossen door te testen met een oudere browser (hebben we ook gedaan). Maar we wilden toch van die waarschuwing af!


###SSLstripV2 + DNSProxy
Dezelfde werkwijze als onze eerste poging
* IPTables
* Manueel ARP pakketjes instellen (1ste window => Ik ben de router > Host, 2de windows => Ik ben de host > Router)
* SSLstrip runnen 

Verschil bij deze is dat iemand een fork heeft gemaakt van de oorspronkelijke SSLstrip om HSTS te omzeilen. De werking hiervan is zeer simpel. Indien er een site gerequest wordt (dns), zal onze aanvaller de dns request uitvoeren maar tegelijk ook zeggen dat de site verplaatst is. Zo zal indien je naar https:/gooogle.com surft, de aanvaller het juiste ip terug geven maar ook zeggen dat https:/www.google.com verplaatst is naar http:/wwwww.google.com (een w teveel). De browser zal dus nu niet meer denken dat hij op Google zit en zal de HSTS check niet uitvoeren. We hebben succesvol https omzeild!

TODO 

![FOTO](http://i.imgur.com/DkTBB9v.jpg)

![FOTO](http://i.imgur.com/uCBNZT1.jpg)

![FOTO](http://i.imgur.com/2JCA5ow.jpg)

![FOTO](http://i.imgur.com/BgeXIaa.jpg)

###With raspberry

install unzip

**We chose to stop our work with the raspberry pi**

###On pc

Problems with twisted-web

GEDULD IS EEN MOOIE ZAAK!

**Got passwords** 
* mitmf -i eth0 --target 192.168.137.64 --gateway 192.168.137.1  --arp --spoof --hsts
* 2 spaties voor --arp!!!!!

**Got images** 
* driftnet -b -i eth0

WORKED WITH WIFI!!!

